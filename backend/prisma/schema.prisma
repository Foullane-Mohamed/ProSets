generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  SELLER
  BUYER
}

enum AssetStatus {
  DRAFT
  PUBLISHED
}

enum OrderStatus {
  PENDING
  PAID
  FAILED
}

model User {
  id               String   @id @default(uuid())
  email            String   @unique
  name             String
  password         String
  stripeCustomerId String?  @map("stripe_customer_id")
  role             Role     @default(BUYER)
  
  assets           Asset[]  @relation("SellerAssets")
  orders           Order[]
  
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@index([email])
  @@map("users")
}

model Asset {
  id          String      @id @default(uuid())
  title       String
  description String
  price       Decimal     @db.Decimal(10, 2)
  fileKey     String      @map("file_key")
  previewKey  String      @map("preview_key")
  status      AssetStatus @default(DRAFT)
  
  sellerId    String      @map("seller_id")
  seller      User        @relation("SellerAssets", fields: [sellerId], references: [id], onDelete: Cascade)
  
  orderItems  OrderItem[]
  createdAt   DateTime    @default(now()) @map("created_at")

  @@index([sellerId])
  @@index([status])
  @@map("assets")
}

model Order {
  id              String      @id @default(uuid())
  userId          String      @map("user_id")
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  status          OrderStatus @default(PENDING)
  totalAmount     Decimal     @map("total_amount") @db.Decimal(10, 2)
  stripeSessionId String?     @unique @map("stripe_session_id")
  
  items           OrderItem[]
  createdAt       DateTime    @default(now()) @map("created_at")

  @@index([userId])
  @@index([status])
  @@map("orders")
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String  @map("order_id")
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  assetId   String  @map("asset_id")
  asset     Asset   @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([assetId])
  @@map("order_items")
}